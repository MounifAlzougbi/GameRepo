pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
-- map

function map_draw()
	for c=1,16 do
		local y=c-1
		y*=8
		for i=1,17	do
			local x=i-1
			x*=8
			if c%2==0 then of=-8 else
			of=0 end
			if i%2==0 then
				spr(1,x+of,y)
			else
				spr(2,x+of,y)
			end
		end
	end
end
-->8
-- array stuff

--[[ @move up, increment tbl+1 
	leave [1] index empty,carry
	index values up
--]]
function move_up(tbl)
	
	add(tbl,pos:new({
	x=tbl[#tbl].x,
	y=tbl[#tbl].y}))
	
	for d=1,#tbl-1 do
		local i=(#tbl-1)-d
		if i>1 then
			tbl[i].x=tbl[i-1].x
			tbl[i].y=tbl[i-1].y
		end
	end
	
--	return tbl
end
-->8
-- snake

function randint(i1,i2)
	int=flr(rnd(i1,i2))
	return int
end

-- @snake init
function snake_init()
	game={
		state='playing'
	}

	pos={
		x=0,
		y=0,
	
		new=function(s,tbl)
			tbl=tbl or {}
			setmetatable(tbl,{
			__index=s
			})
			return tbl
		end
	}
	
	snake={
		dirs={
		'up','down','left','right'},
		
		dir='right',
		speed=0.5,
		x=64,y=64,
		mx=8,my=8,
		lx=8,ly=8,	-- last x,y
--		dx=0,dy=0,	-- delta x,y
		length=3,-- not including head
		lp={},		-- last pos
		
		init=function(s)
			add(s.lp,{
				x=8,
				y=8
			})
			add(s.lp,{
				x=8,
				y=8
			})
		end,
		
		update=function(s)		
			
			if s.dir=='right' then
				s.x+=s.speed
			elseif s.dir=='left' then
				s.x-=s.speed
			elseif s.dir=='up' then
				s.y-=s.speed
			elseif s.dir=='down' then
				s.y+=s.speed
			end
			
			s.mx=flr(s.x/8)
			s.my=flr(s.y/8)
			
			if s.mx!=s.lx
			or s.my!=s.ly then
				add(s.lp,pos:new({
				x=s.lx,
				y=s.ly}))
				s.lx=s.mx
				s.ly=s.my
			end

			for i=1,#s.lp do
				if s.lp[i].x !=nil
				and s.lp[i].y!=nil 
				and i>#s.lp-s.length 
				and s.length>3 then
					local x=s.lp[i].x
					local y=s.lp[i].y
					if s.mx==x
					and s.my==y then
						game.state='loss'
					end
				end
			end

			if s.mx<=-1 then
				s.x=128
			elseif s.mx>=16 then
				s.x=0
			elseif s.my<=-1 then
				s.y=128
			elseif s.my>=16 then
				s.y=0
			end

			s.lx=flr(s.x/8)
			s.ly=flr(s.y/8)
		end,
		
		draw=function(s)
			local x=flr(s.x/8)
			local y=flr(s.y/8)
			
			x*=8
			y*=8
			
			for i=1,#s.lp do
				if s.lp[i].x !=nil
				and s.lp[i].y!=nil 
				and i>#s.lp-s.length then
					local x=s.lp[i].x*8
					local y=s.lp[i].y*8
					spr(20,x,y)
				end
			end
			
			if s.dir=='right' then
				spr(17,x,y)
			elseif s.dir=='left' then
				spr(19,x,y)
			elseif s.dir=='up' then
				spr(16,x,y)
			elseif s.dir=='down' then
				spr(18,x,y)
			end
		
		end
		
	}
	
-- @apple
	apple={
		x=0,
		y=0,
		
		init=function(s)
			if x==0 or x==nil then
				s.x=flr(rnd(15))
				s.y=flr(rnd(15))
			end
		end,
		
		update=function(s)
			if s.x==snake.mx
			and s.y==snake.my then
				s.x=flr(rnd(15))
				s.y=flr(rnd(15))
				snake.length+=1
				snake.speed+=0.04
				for i=1,#snake.lp do
				if snake.lp[i].x !=nil
				and snake.lp[i].y!=nil 
				and i>#snake.lp-snake.length then
					local x=snake.lp[i].x
					local y=snake.lp[i].y
					if s.x==x
					and s.y==y then
						s.x=flr(rnd(15))
						s.y=flr(rnd(15))
					end
				end
			end
			end
		end,
		
		draw=function(s)
			local x=s.x*8
			local y=s.y*8
			spr(21,x,y)
		end
		
	}
	
	apple:init()
	snake:init()
end

-- @snake update
function snake_update()

	if btn(⬆️) 
	and snake.dir!='down' then
		snake.dir=snake.dirs[1]
	elseif btn(⬇️)
	and snake.dir!='up' then
		snake.dir=snake.dirs[2]
	elseif btn(⬅️)
	and snake.dir!='right' then
		snake.dir=snake.dirs[3]
	elseif btn(➡️)
	and snake.dir!='left' then
		snake.dir=snake.dirs[4]
	end
	
	snake:update()
	apple:update()
end

-- @snake draw
function snake_draw()
	
	apple:draw()
	snake:draw()
	
end
-->8
--
-->8
-- game loop

function _init()
	snake_init()
end

function _update()
	if game.state!='loss' then
		snake_update()
	end
end

function _draw()
	cls()
	map_draw()
	snake_draw()
	print(game.state,9)
end

__gfx__
bbbbbbbb33333333bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb33333333bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbb555533333333bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbb5bb533333333bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbb5bbb33333333bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb33333333bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb33333333bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb33333333bbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111110000030000000000000000000000000000000000000000000000000000000000000000000000000000000000
15111151111116511111111115611111111111110003300000000000000000000000000000000000000000000000000000000000000000000000000000000000
16111161111111111111511111111111111111110083880000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111511111115111111111511111151110888888000000000000000000000000000000000000000000000000000000000000000000000000000000000
11115111115111111111111111115111111511110888888000000000000000000000000000000000000000000000000000000000000000000000000000000000
11151111111111111611116111111111111111110088880000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111116511511115115611111111111110008800000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000002020202040100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0102011001100110011001100110011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201020110011001000110011001100100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102011001100110011001100110011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201020102010201100110011001100100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010201020110011001100110011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201020102010201100110011001100100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010201020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
