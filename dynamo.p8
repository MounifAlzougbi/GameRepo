pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
// 8 way rotation, thrust and 
// direction changes keplarian 
// orbit/rail

test={{{index=1,num=2},{{index=2,num=3},{index=2,num=3}}}}

g=0.5 // gravitational constant

physics_delta=1/60 // update60

vect_0={x=0,y=0,mag=0}

lander={ x=64,y=20,
	vel_x=2.3,vel_y=0,
	accel_x=0,accel_y=0,
 mass=100,fuel=600,
	thrust=100,spin=0,
	vect_x=0,vect_y=0,mag=0}
	// 1=⬆️, 2=tp right 3=➡️
spin=lander.spin 

body_1={ x=64,y=64,vel_x,vel_y,
 mass=10000,radius=32}
 
body_2={ x=128,y=0,vel_x,vel_y,
 mass=1000,radius=10}

function distance(t_1,t_2)
	ax=t_1.x-t_2.x
	ay=t_1.y-t_2.y
	distance_sqr=(ax*ax)+(ay*ay)
	return sqrt(distance_sqr)
end

function apply_gravity(ship,body)
	//body=body_1  //depends on soi // sphere of influence
	local distance=distance(ship,body)
	fx,fy=vect_to(body,lander,distance)
	force_mag=(g*ship.mass*body.mass)/(distance*distance)
	fx=fx*force_mag
	fy=fy*force_mag
	ship.accel_x=-fx/ship.mass
	ship.accel_y=-fy/ship.mass
end// ⬆️ grav repulse w/o -fx/y

// returns normal vect to target
function vect_to(target,ship,distance)
	ax=target.x-ship.x
	ay=target.y-ship.y
	nx,ny=ax/distance,ay/distance
	return nx,ny
end
 
function gravity_force(body,ship)
	distance=distance_to(body,ship)
	return min(10,1000/(distance*distance))
// deepseek⬆️ 
end
 
function apply_velocities(ship)
	ship.vel_x+=ship.accel_x*physics_delta
	ship.vel_y+=ship.accel_y*physics_delta
	ship.x+=ship.vel_x*physics_delta
	ship.y+=ship.vel_y*physics_delta
end
 
calls=0

function ship_spr(call,spin)
 calls=calls+call
 if (call==0) then
		spin=lander.spin
	elseif (spin>0 and spin<8) then
		return spin
	elseif (spin>8) then
		spin-=8
		calls+=1
		ship_spr(1,spin)
	elseif (spin<0) then
		spin+=8
		calls+=1
		ship_spr(1,spin)
	end 
	
--	print((13%2))

--	return 8
end
 
function _init()
	
end

function _update60()
	
	apply_gravity(lander,body_1)
	apply_velocities(lander)
	lander.spin=ship_spr(0,lander.spin)
end

function _draw()
	cls()
	circfill(body_1.x,body_1.y,body_1.radius,3)
	circfill(body_2.x,body_2.y,body_2.radius,5)
	print(distance(body_1,lander))
--	print(lander.mass,64,64)
 spr(spin,lander.x-4,lander.y-4)
	print(lander.accel_y)
	print(test[1].index)
end

__gfx__
000dd00000000ddd00000000005d00000d5005d00000d50000000000ddd000000800000800000000000000000000000000000000000000000000000000000000
00d99d000000999ddd000000000dd0000dd99dd0000dd000000000ddd99900000080008800000000000000000000000000000000000000000000000000000000
009999000009999d5dd999d05099900000d99d00000999050d999dd5d99990000008088000000000000000000000000000000000000000000000000000000000
009999000d9999900999999ddd99990000999900009999ddd9999990099999d00000880000000000000000000000000000000000000000000000000000000000
00999900dd9999000999999d0d99999000999900099999d0d9999990009999dd0088080000000000000000000000000000000000000000000000000000000000
00d99d00509990005dd999d00009999d00999900d99990000d999dd5000999050880080000000000000000000000000000000000000000000000000000000000
0dd99dd0000dd000dd0000000000999d00d99d00d9990000000000dd000dd0000800008000000000000000000000000000000000000000000000000000000000
0d5005d0005d00000000000000000ddd000dd000ddd00000000000000000d5000000000000000000000000000000000000000000000000000000000000000000
000aa000000000a000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000000000
009aa900000099aa0000000000000000000000000000000000000000aa9900000000000000000000000000000000000000000000000000000000000000000000
0089980000089a90000088900000000000088000000000000880000009a980000000000000000000000000000000000000000000000000000000000000000000
0089980000088990008899aa000888000008800000888000a9988000099980000000000000000000000000000000000000000000000000000000000000000000
0008800000008800008899aa000899900089980009998000a9988000008880000000000000000000000000000000000000000000000000000000000000000000
00088000000000000000889000089a900089980009a9800008800000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000099aa009aa900aa99000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000a0000aa0000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000aa000000000a000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000000000
008998000000099a0000000000000000000000000000000000000000a99000000000000000000000000000000000000000000000000000000000000000000000
00899800000088900000088000000000000000000000000008800000098800000000000000000000000000000000000000000000000000000000000000000000
00088000000008000000899a000000000000000000000000a9980000008000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000899a000008000008800000800000a9980000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000088000008890008998000988000008800000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000099a00899800a990000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000a0000aa0000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
